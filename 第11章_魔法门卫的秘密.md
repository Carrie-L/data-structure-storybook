## ç¬¬11ç«  é­”æ³•é—¨å«çš„ç§˜å¯†

_"æœ‰äº›é—¨ï¼Œå®å¯å¤šæ‹¦ä¸€ä¸ªæ— è¾œï¼Œä¹Ÿä¸èƒ½æ”¾è¿‡ä¸€ä¸ªåäººã€‚"_

æ½¼æ½¼æ­£è¹²åœ¨DSAå®éªŒå®¤é—¨å£ï¼Œå¯¹ç€åˆšåˆ°çš„å¿«é€’å‘˜"å–µå–µ"åœ°å«ç€ï¼Œå°é»‘çˆªå­æŒ¥èˆå¾—ç‰¹åˆ«å‡¶ã€‚

"æ½¼æ½¼ï¼Œåˆ«è¿™æ ·ï¼"å®‰å¦®èµ¶ç´§è·‘è¿‡å»ï¼Œç²‰è‰²å·å‘æœ‰ç‚¹å‡Œä¹±ï¼Œ"äººå®¶åªæ˜¯é€å¿«é€’çš„å•¦ï¼"

å¿«é€’å‘˜ç¬‘ç€æ‘‡æ‘‡å¤´ï¼š"æ²¡äº‹ï¼Œè¿™å°å®¶ä¼™æŒºè­¦æƒ•çš„ï¼Œæ˜¯ä¸ªç§°èŒçš„é—¨å«ã€‚"

å¸Œå¨…æ”¾ä¸‹æ‰‹é‡Œçš„è“è‰²å¤§è€³ç¯ï¼Œå¥½å¥‡åœ°é—®ï¼š"ç­‰ç­‰ï¼Œæ½¼æ½¼æ€ä¹ˆçŸ¥é“è¦æ‹¦ä»–ï¼Ÿæ˜æ˜ä¹‹å‰ä¹Ÿæœ‰å…¶ä»–é™Œç”Ÿäººæ¥è¿‡ï¼Œå®ƒéƒ½æ²¡ååº”è¿™ä¹ˆå¤§ã€‚"

"å¯èƒ½æ˜¯ç›´è§‰ï¼Ÿ"ä¼Šèè´å°”æ¸©æŸ”åœ°æŠšæ‘¸ç€æ½¼æ½¼çš„å°è„‘è¢‹ï¼Œ"å°åŠ¨ç‰©å¯¹é™Œç”Ÿäººå¾ˆæ•æ„Ÿçš„ã€‚"

é»›èŠ™ä»ç”µè„‘å‰æŠ¬èµ·å¤´ï¼Œé“¶ç°è‰²çš„çœ¼çœ¸é—ªè¿‡ä¸€ä¸æ€è€ƒçš„å…‰èŠ’ï¼š"è¿™è®©æˆ‘æƒ³èµ·ä¸€ä¸ªæœ‰è¶£çš„æ•°æ®ç»“æ„â€”â€”å¸ƒéš†è¿‡æ»¤å™¨ã€‚å°±åƒæ½¼æ½¼è¿™æ ·çš„'é­”æ³•é—¨å«'ã€‚"

"å¸ƒéš†è¿‡æ»¤å™¨ï¼Ÿ"å®‰å¦®å¥½å¥‡åœ°çœ¨çœ¨ç¢§ç»¿è‰²çš„çœ¼ç›ï¼Œ"å¬èµ·æ¥åƒæ˜¯ä»€ä¹ˆé­”æ³•é“å…·ï¼"

æ½¼æ½¼"å–µ"äº†ä¸€å£°ï¼Œå¥½åƒåœ¨è¯´"æˆ‘å°±æ˜¯é­”æ³•é—¨å«ï¼"ï¼Œç„¶åè·³åˆ°äº†é»›èŠ™çš„è†ç›–ä¸Šã€‚

"å—¯ï¼Œç¡®å®å¾ˆåƒé­”æ³•ã€‚"é»›èŠ™è½»æŠšç€æ½¼æ½¼çš„å°è„‘è¢‹ï¼Œ"å¸ƒéš†è¿‡æ»¤å™¨çš„å·¥ä½œæ–¹å¼å°±åƒä¸€ä¸ªæ°¸è¿œä¸ä¼šæ”¾è¿‡åäººï¼Œä½†å¯èƒ½ä¼šè¯¯æ‹¦å¥½äººçš„é—¨å«ç³»ç»Ÿã€‚"

å¸Œå¨…æ¥äº†å…´è¶£ï¼Œé‡‘è‰²æ³¢æµªå·å‘åœ¨é˜³å…‰ä¸‹é—ªé—ªå‘å…‰ï¼š"æ€ä¹ˆä¸ªè¯¯æ‹¦æ³•ï¼Ÿéš¾é“é—¨å«ä¹Ÿä¼šè®¤é”™äººï¼Ÿ"

"è®©æˆ‘ä»¬åšä¸ªå°å®éªŒæ¥ç†è§£å®ƒï¼"é»›èŠ™ç«™èµ·èº«ï¼Œæ½¼æ½¼çµå·§åœ°è·³åˆ°å¥¹çš„è‚©è†€ä¸Šã€‚

å¥¹åœ¨ç™½æ¿ä¸Šç”»äº†ä¸€ä¸ªç®€å•çš„ç¤ºæ„å›¾ï¼š

```
ğŸ° é­”æ³•åŸå ¡çš„é—¨å«ç³»ç»Ÿ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æƒ³è±¡ä¸€ä¸ªé­”æ³•åŸå ¡æœ‰ä¸‰ä¸ªé—¨å«ï¼šé˜¿ä¸€ã€é˜¿äºŒã€é˜¿ä¸‰
æ¯ä¸ªé—¨å«éƒ½æœ‰ä¸€æœ¬"å¯ç–‘äººå‘˜è®°å½•æœ¬"

å½“æœ‰äººè¦è¿›åŸå ¡æ—¶ï¼š
1. ä¸‰ä¸ªé—¨å«åŒæ—¶æ£€æŸ¥è‡ªå·±çš„è®°å½•æœ¬
2. å¦‚æœä»»ä½•ä¸€ä¸ªé—¨å«è¯´"æˆ‘æ²¡è§è¿‡è¿™ä¸ªäºº" â†’ ç»å¯¹æ˜¯æ–°äººï¼Œæ”¾è¡Œ âœ…
3. å¦‚æœä¸‰ä¸ªé—¨å«éƒ½è¯´"æˆ‘å¥½åƒè§è¿‡è¿™ä¸ªäºº" â†’ å¯èƒ½æ˜¯ç†Ÿäººï¼Œä»”ç»†æ ¸å® âš ï¸

å…³é”®ç‚¹ï¼šé—¨å«å¯èƒ½è®°é”™ï¼ˆæŠŠé™Œç”Ÿäººå½“ç†Ÿäººï¼‰ï¼Œä½†ç»ä¸ä¼šå¿˜è®°çœŸæ­£è§è¿‡çš„äººï¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

"å“¦ï¼"å®‰å¦®çœ¼ç›ä¸€äº®ï¼Œ"æ‰€ä»¥å¦‚æœæœ‰é—¨å«è¯´æ²¡è§è¿‡ï¼Œå°±è‚¯å®šæ˜¯é™Œç”Ÿäººï¼Ÿ"

"æ­£ç¡®ï¼"é»›èŠ™éš¾å¾—éœ²å‡ºèµè®¸çš„è¡¨æƒ…ï¼Œ"è¿™å°±æ˜¯å¸ƒéš†è¿‡æ»¤å™¨æœ€é‡è¦çš„ç‰¹æ€§â€”â€”**æ²¡æœ‰å‡é˜´æ€§**ã€‚å®ƒç»å¯¹ä¸ä¼šæ¼æ‰çœŸæ­£å­˜åœ¨çš„å…ƒç´ ã€‚"

"ä½†æ˜¯..."ä¼Šèè´å°”è½»å£°é—®é“ï¼Œ"ä¸ºä»€ä¹ˆä¼šæŠŠé™Œç”Ÿäººå½“ç†Ÿäººå‘¢ï¼Ÿ"

"è¿™å°±è¦ä»å¸ƒéš†è¿‡æ»¤å™¨çš„å®ç°åŸç†è¯´èµ·äº†ã€‚"é»›èŠ™å¼€å§‹åœ¨ç™½æ¿ä¸Šç”»æ›´è¯¦ç»†çš„å›¾ï¼Œ"å®ƒä½¿ç”¨çš„æ˜¯ä¸€ç§å¾ˆå·§å¦™çš„å­˜å‚¨æ–¹å¼ã€‚"

å¸Œå¨…æ¥äº†å…´è¶£ï¼š"å…·ä½“æ€ä¹ˆå®ç°ï¼Ÿæˆ‘ä»¬èƒ½å†™ä»£ç è¯•è¯•å—ï¼Ÿ"

"æˆ‘ä»¬å…ˆä»æœ€ç®€å•çš„ä¾‹å­å¼€å§‹ã€‚"é»›èŠ™æ¸…äº†æ¸…å—“å­ï¼Œ"å‡è®¾æˆ‘ä»¬æœ‰8ä¸ªå°ç›’å­ï¼Œç¼–å·0åˆ°7ï¼Œåˆšå¼€å§‹éƒ½æ˜¯ç©ºçš„ã€‚"

```python
# ç®€å•çš„å¸ƒéš†è¿‡æ»¤å™¨å®ç°
class SimpleBloomFilter:
    def __init__(self, size=8):
        """åˆå§‹åŒ–æˆ‘ä»¬çš„é­”æ³•é—¨å«ç³»ç»Ÿ
        
        Args:
            size: é—¨å«è®°å½•æœ¬çš„é¡µæ•°ï¼Œé»˜è®¤8é¡µç”¨äºæ¼”ç¤º
        """
        self.size = size
        self.bit_array = [0] * size  # åˆ›å»ºä¸€æ’ç©ºç™½çš„è®°å½•æœ¬ï¼Œç­‰å¾…é—¨å«ä»¬åšæ ‡è®°
        print(f"å¸ƒéš†è¿‡æ»¤å™¨å¯åŠ¨ï¼ä½æ•°ç»„å¤§å°: {size}")
        print(f"åˆå§‹çŠ¶æ€: {self.bit_array}")
        
    def _hash1(self, item):
        """ç¬¬ä¸€ä¸ªé—¨å«é˜¿ä¸€çš„è®°å¿†æ–¹å¼ï¼šæ ¹æ®åå­—é•¿åº¦æ‰¾ä½ç½®"""
        return len(str(item)) % self.size
        
    def _hash2(self, item):
        """ç¬¬äºŒä¸ªé—¨å«é˜¿äºŒçš„è®°å¿†æ–¹å¼ï¼šæŠŠåå­—æ¯ä¸ªå­—æ¯åŠ èµ·æ¥"""
        return sum(ord(char) for char in str(item)) % self.size
        
    def _hash3(self, item):
        """ç¬¬ä¸‰ä¸ªé—¨å«é˜¿ä¸‰çš„è®°å¿†æ–¹å¼ï¼šç”¨Pythonçš„é­”æ³•hashå‡½æ•°"""
        return abs(hash(str(item))) % self.size
    
    def add(self, item):
        """æœ‰æ–°ç”¨æˆ·æ³¨å†Œäº†ï¼ä¸‰ä¸ªé—¨å«èµ¶ç´§åœ¨è®°å½•æœ¬ä¸Šåšæ ‡è®°"""
        print(f"\næ·»åŠ ç”¨æˆ·: '{item}'")
        
        # ä¸‰ä¸ªé—¨å«åˆ†åˆ«ç”¨è‡ªå·±çš„æ–¹å¼è®¡ç®—è¦åœ¨å“ªä¸€é¡µåšæ ‡è®°
        pos1 = self._hash1(item)
        pos2 = self._hash2(item)
        pos3 = self._hash3(item)
        
        print(f"   é—¨å«é˜¿ä¸€: '{item}' -> è®°å½•åœ¨ç¬¬ {pos1} é¡µ")
        print(f"   é—¨å«é˜¿äºŒ: '{item}' -> è®°å½•åœ¨ç¬¬ {pos2} é¡µ")
        print(f"   é—¨å«é˜¿ä¸‰: '{item}' -> è®°å½•åœ¨ç¬¬ {pos3} é¡µ")
        
        # ä¸‰ä¸ªé—¨å«åŒæ—¶åœ¨å„è‡ªç®—å‡ºçš„é¡µé¢ç”»ä¸ªå‹¾
        self.bit_array[pos1] = 1
        self.bit_array[pos2] = 1
        self.bit_array[pos3] = 1
        
        print(f"   è®°å½•æœ¬æ›´æ–°: {self.bit_array}")
        
    def contains(self, item):
        """æœ‰äººè¦ç™»å½•ï¼å¿«è®©é—¨å«ä»¬æ£€æŸ¥è®°å½•æœ¬"""
        print(f"\næ£€æŸ¥ç”¨æˆ·: '{item}'")
        
        # ä¸‰ä¸ªé—¨å«ç”¨åŒæ ·çš„æ–¹å¼ç®—å‡ºè¦æŸ¥å“ªå‡ é¡µ
        pos1 = self._hash1(item)
        pos2 = self._hash2(item)
        pos3 = self._hash3(item)
        
        print(f"   éœ€è¦æ£€æŸ¥çš„é¡µé¢: {pos1}, {pos2}, {pos3}")
        print(f"   å½“å‰è®°å½•æœ¬çŠ¶æ€: {self.bit_array}")
        
        # ä¸‰ä¸ªé—¨å«åˆ†åˆ«æ£€æŸ¥è‡ªå·±è´Ÿè´£çš„é¡µé¢æœ‰æ²¡æœ‰æ ‡è®°
        bit1 = self.bit_array[pos1]
        bit2 = self.bit_array[pos2]
        bit3 = self.bit_array[pos3]
        
        print(f"   é—¨å«é˜¿ä¸€æŸ¥ç¬¬ {pos1} é¡µ: {'æœ‰æ ‡è®°' if bit1 else 'æ²¡æ ‡è®°'}")
        print(f"   é—¨å«é˜¿äºŒæŸ¥ç¬¬ {pos2} é¡µ: {'æœ‰æ ‡è®°' if bit2 else 'æ²¡æ ‡è®°'}")
        print(f"   é—¨å«é˜¿ä¸‰æŸ¥ç¬¬ {pos3} é¡µ: {'æœ‰æ ‡è®°' if bit3 else 'æ²¡æ ‡è®°'}")
        
        if bit1 == 1 and bit2 == 1 and bit3 == 1:
            print(f"   ä¸‰ä¸ªé—¨å«éƒ½è¯´è§è¿‡ -> '{item}' å¯èƒ½æ˜¯è€ç”¨æˆ·ï¼Œå…è®¸ç™»å½•")
            return True
        else:
            print(f"   æœ‰é—¨å«è¯´æ²¡è§è¿‡ -> '{item}' ç»å¯¹æ˜¯æ–°ç”¨æˆ·ï¼Œè¯·å…ˆæ³¨å†Œ")
            return False

# è®©æˆ‘ä»¬æ¥æµ‹è¯•è¿™ä¸ªé­”æ³•é—¨å«ç³»ç»Ÿ
print("=== é­”æ³•åŸå ¡é—¨å«ç³»ç»Ÿæµ‹è¯• ===")
bloom = SimpleBloomFilter(size=8)

# å…ˆè®©å‡ ä¸ªç”¨æˆ·æ³¨å†Œï¼Œé—¨å«ä»¬åšå¥½è®°å½•
print("\nç”¨æˆ·æ³¨å†Œé˜¶æ®µ:")
users_to_add = ["alice", "bob"]
for user in users_to_add:
    bloom.add(user)

print("\nç”¨æˆ·ç™»å½•éªŒè¯:")
users_to_check = ["alice", "bob", "charlie", "david"]

for user in users_to_check:
    exists = bloom.contains(user)
    if exists:
        print(f"  '{user}': é—¨å«ä»¬è§‰å¾—çœ¼ç†Ÿï¼Œå…è®¸ç™»å½•")
    else:
        print(f"  '{user}': ç¡®å®šæ˜¯æ–°é¢å­”ï¼Œè¯·å…ˆæ³¨å†Œè´¦å·")
```

ä»£ç è·‘å®Œåï¼Œå®‰å¦®å…´å¥‹åœ°æ‹æ‰‹ï¼š"æˆ‘æ‡‚äº†ï¼å°±åƒä¸‰ä¸ªé—¨å«åœ¨ä¸åŒçš„è®°å½•æœ¬ä¸Šåšæ ‡è®°ï¼Œå¦‚æœæœ‰äººè¿åœ¨ä»»ä½•ä¸€æœ¬è®°å½•æœ¬ä¸Šéƒ½æ²¡æ ‡è®°ï¼Œé‚£è‚¯å®šæ˜¯æ–°ç”¨æˆ·ï¼Œéœ€è¦å…ˆæ³¨å†Œï¼"

"ä½†æ˜¯å¦‚æœä¸‰æœ¬è®°å½•æœ¬ä¸Šéƒ½æœ‰æ ‡è®°ï¼Œ"å¸Œå¨…è‹¥æœ‰æ‰€æ€ï¼Œ"ä¹Ÿå¯èƒ½æ˜¯å› ä¸ºä¹‹å‰æ³¨å†Œè¿‡çš„ä¸åŒç”¨æˆ·ç¢°å·§åœ¨åŒæ ·çš„ä½ç½®åšäº†æ ‡è®°ï¼Œæ‰€ä»¥å¯èƒ½è¯¯è®¤ä¸ºæ˜¯è€ç”¨æˆ·ã€‚"

"exactlyï¼"é»›èŠ™ç‚¹å¤´ï¼Œ"è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¼šå‡ºç°**å‡é˜³æ€§**â€”â€”è¯¯æŠŠæ–°ç”¨æˆ·å½“æˆè€ç”¨æˆ·ã€‚è®©æˆ‘ä»¬æ¥çœ‹ä¸ªå…·ä½“ä¾‹å­ã€‚"

ä¼Šèè´å°”æ¸©æŸ”åœ°é—®ï¼š"é‚£ä¸ºä»€ä¹ˆä¸ç”¨ä¸€ä¸ªæ›´ç²¾ç¡®çš„æ–¹æ³•å‘¢ï¼Ÿæ¯”å¦‚ç›´æ¥å­˜å‚¨æ¯ä¸ªç”¨æˆ·åï¼Ÿ"

"å¥½é—®é¢˜ï¼"é»›èŠ™åœ¨ç™½æ¿ä¸Šç”»äº†ä¸€ä¸ªå¯¹æ¯”å›¾ï¼š

```
ğŸ“Š å­˜å‚¨æ–¹å¼å¯¹æ¯”
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ä¼ ç»Ÿæ–¹å¼ï¼ˆç²¾ç¡®å­˜å‚¨ï¼‰ï¼š
  å­˜å‚¨å†…å®¹ï¼š["alice", "bob", "charlie", "david", ...]
  ä¼˜ç‚¹ï¼š100% å‡†ç¡®ï¼Œç»æ— è¯¯åˆ¤
  ç¼ºç‚¹ï¼šéœ€è¦å­˜å‚¨å®Œæ•´ä¿¡æ¯ï¼Œå ç”¨ç©ºé—´å¤§ï¼ŒæŸ¥æ‰¾é€Ÿåº¦æ…¢

å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆä½æ ‡è®°ï¼‰ï¼š
  å­˜å‚¨å†…å®¹ï¼š[1, 0, 1, 1, 0, 1, 0, 1]  â† åªéœ€è¦å¾ˆå°‘çš„0å’Œ1
  ä¼˜ç‚¹ï¼šå ç”¨ç©ºé—´æå°ï¼ŒæŸ¥æ‰¾é€Ÿåº¦è¶…å¿«
  ç¼ºç‚¹ï¼šå¯èƒ½è¯¯åˆ¤ï¼ˆå‡é˜³æ€§ï¼‰ï¼Œä½†ç»ä¸é—æ¼ï¼ˆæ— å‡é˜´æ€§ï¼‰

ä½¿ç”¨åœºæ™¯ï¼š
âœ… å½“éœ€è¦å¿«é€Ÿæ’é™¤"ç»å¯¹ä¸å­˜åœ¨"çš„æƒ…å†µ
âœ… å½“å¶å°”è¯¯åˆ¤æ¯”é—æ¼æ›´èƒ½æ¥å—  
âœ… å½“å¤„ç†æµ·é‡æ•°æ®ï¼Œå­˜å‚¨ç©ºé—´å®è´µ

å®é™…åº”ç”¨ä¸­çš„å¤„ç†æ–¹å¼ï¼š
- å¦‚æœå¸ƒéš†è¿‡æ»¤å™¨è¯´"ä¸å­˜åœ¨" â†’ ç›´æ¥åˆ¤å®šä¸ºæ–°ç”¨æˆ·ï¼Œè¿›å…¥æ³¨å†Œæµç¨‹
- å¦‚æœå¸ƒéš†è¿‡æ»¤å™¨è¯´"å­˜åœ¨" â†’ å¯èƒ½æ˜¯è€ç”¨æˆ·ï¼Œéœ€è¦è¿›ä¸€æ­¥éªŒè¯ï¼ˆæŸ¥æ•°æ®åº“ç¡®è®¤ï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

"è¿™ä¸ªæ¯”å–»å¤ªæ£’äº†ï¼"å¸Œå¨…çœ¼ç›å‘äº®ï¼Œ"å°±åƒæˆ‘ä»¬çš„è®°å¿†ï¼Œé—»åˆ°æŸç§é¦™æ°´å¯èƒ½æƒ³èµ·æŸä¸ªäººï¼Œä½†ä¹Ÿå¯èƒ½å¼„é”™ï¼Œå› ä¸ºä¸åŒçš„äººå¯èƒ½ç”¨åŒæ ·çš„é¦™æ°´ï¼"

é»›èŠ™éœ²å‡ºäº†éš¾å¾—çš„å¾®ç¬‘ï¼š"è®©æˆ‘ä»¬æ¥çœ‹çœ‹çœŸå®ä¸–ç•Œä¸­å¸ƒéš†è¿‡æ»¤å™¨æ˜¯æ€ä¹ˆä¼˜åŒ–çš„ã€‚"

```python
# ä¼˜åŒ–çš„å¸ƒéš†è¿‡æ»¤å™¨å®ç°
import hashlib
import math

class OptimizedBloomFilter:
    def __init__(self, expected_elements=1000, false_positive_rate=0.01):
        """
        æ™ºèƒ½é­”æ³•é—¨å«ç³»ç»Ÿï¼è‡ªåŠ¨è®¡ç®—æœ€ä½³é…ç½®
        
        Args:
            expected_elements: é¢„è®¡ä¼šæœ‰å¤šå°‘ç”¨æˆ·ï¼ˆé»˜è®¤1000äººï¼‰
            false_positive_rate: èƒ½å®¹å¿å¤šå°‘è¯¯åˆ¤ï¼ˆå¦‚0.01è¡¨ç¤º100ä¸ªé‡Œé”™1ä¸ªï¼‰
        """
        self.expected_elements = expected_elements
        self.false_positive_rate = false_positive_rate
        
        # ç”¨æ•°å­¦é­”æ³•ç®—å‡ºæœ€åˆé€‚çš„è®°å½•æœ¬å¤§å°
        # å…¬å¼: m = -(n * ln(p)) / (ln(2)^2)
        # ç¿»è¯‘ï¼šè®°å½•æœ¬é¡µæ•° = -(ç”¨æˆ·æ•° Ã— ln(è¯¯åˆ¤ç‡)) Ã· (ln(2)Â²)
        self.size = int(-expected_elements * math.log(false_positive_rate) / (math.log(2) ** 2))
        
        # ç®—å‡ºéœ€è¦å‡ ä¸ªé—¨å«æœ€åˆé€‚
        # å…¬å¼: k = (m/n) * ln(2)  
        # ç¿»è¯‘ï¼šé—¨å«æ•° = (é¡µæ•°Ã·ç”¨æˆ·æ•°) Ã— ln(2)
        self.hash_count = int((self.size / expected_elements) * math.log(2))
        self.hash_count = max(1, self.hash_count)  # è‡³å°‘è¦æœ‰1ä¸ªé—¨å«
        
        # å‡†å¤‡ä¸€æ’å´­æ–°çš„è®°å½•æœ¬
        self.bit_array = [0] * self.size
        self.elements_added = 0
        
        print(f"æ™ºèƒ½é—¨å«ç³»ç»Ÿé…ç½®å®Œæˆ:")
        print(f"   é¢„æœŸç”¨æˆ·æ•°é‡: {expected_elements}")
        print(f"   æœŸæœ›è¯¯åˆ¤ç‡: {false_positive_rate:.1%}")
        print(f"   è®°å½•æœ¬é¡µæ•°: {self.size}")
        print(f"   é—¨å«æ•°é‡: {self.hash_count}")
        
    def _get_hash_values(self, item):
        """ç”¨åŒé‡å“ˆå¸Œé­”æ³•ç”Ÿæˆå¤šä¸ªç‹¬ç‰¹çš„è®°å½•ä½ç½®"""
        # æŠŠç”¨æˆ·å§“åè½¬æ¢æˆæ•°å­—ï¼ˆè®¡ç®—æœºèƒ½ç†è§£çš„æ ¼å¼ï¼‰
        item_str = str(item).encode('utf-8')
        hash1 = int(hashlib.md5(item_str).hexdigest(), 16)   # ç¬¬ä¸€ç§é­”æ³•ç¼–ç 
        hash2 = int(hashlib.sha1(item_str).hexdigest(), 16)  # ç¬¬äºŒç§é­”æ³•ç¼–ç 
        
        # ç”¨åŒé‡å“ˆå¸Œå’’è¯­ç”Ÿæˆä¸åŒçš„é¡µç 
        # å…¬å¼: ç¬¬iä¸ªä½ç½® = (ç¼–ç 1 + i Ã— ç¼–ç 2) mod æ€»é¡µæ•°
        hash_values = []
        for i in range(self.hash_count):
            hash_val = (hash1 + i * hash2) % self.size
            hash_values.append(hash_val)
            
        return hash_values
        
    def add(self, item):
        """æ–°ç”¨æˆ·æ³¨å†Œï¼é—¨å«ä»¬å„è‡ªåœ¨è®°å½•æœ¬ä¸Šåšæ ‡è®°"""
        hash_values = self._get_hash_values(item)
        
        print(f"æ³¨å†Œç”¨æˆ·: '{item}'")
        print(f"   æ ‡è®°é¡µç : {hash_values}")
        
        # æ¯ä¸ªé—¨å«åœ¨å„è‡ªè®¡ç®—çš„é¡µé¢ç”»å‹¾
        for hash_val in hash_values:
            self.bit_array[hash_val] = 1
            
        self.elements_added += 1
        
        # å®æ—¶è®¡ç®—ç³»ç»Ÿçš„å¥åº·åº¦ 
        current_bits_set = sum(self.bit_array)  # å·²ç»åšæ ‡è®°çš„é¡µæ•°
        estimated_fpr = (current_bits_set / self.size) ** self.hash_count
        print(f"   é¢„è®¡è¯¯åˆ¤ç‡: {estimated_fpr:.3%} (è¶Šä½è¶Šå¥½)")
        
    def contains(self, item):
        """èº«ä»½éªŒè¯ï¼é—¨å«ä»¬å¿«é€Ÿæ£€æŸ¥è®°å½•æœ¬"""
        hash_values = self._get_hash_values(item)
        
        # æ¯ä¸ªé—¨å«æ£€æŸ¥è‡ªå·±è´Ÿè´£çš„é¡µé¢
        for hash_val in hash_values:
            if self.bit_array[hash_val] == 0:
                return False  # æœ‰é—¨å«è¯´"æˆ‘æ²¡è§è¿‡ï¼" -> ç»å¯¹æ˜¯æ–°ç”¨æˆ·
                
        return True  # æ‰€æœ‰é—¨å«éƒ½è¯´"å¥½åƒè§è¿‡..." -> å¯èƒ½æ˜¯è€ç”¨æˆ·
        
    def get_stats(self):
        """ç³»ç»Ÿè¿è¡ŒæŠ¥å‘Šï¼ˆçœ‹çœ‹é—¨å«ä»¬å¹²å¾—æ€ä¹ˆæ ·ï¼‰"""
        bits_set = sum(self.bit_array)           # åšäº†æ ‡è®°çš„é¡µæ•°
        fill_rate = bits_set / self.size         # è®°å½•æœ¬"å†™æ»¡"ç¨‹åº¦
        estimated_fpr = fill_rate ** self.hash_count  # é¢„è®¡è¯¯åˆ¤ç‡
        
        return {
            "elements_added": self.elements_added,
            "bits_set": bits_set,
            "fill_rate": fill_rate,
            "estimated_false_positive_rate": estimated_fpr
        }


# å®æˆ˜åº”ç”¨ï¼šæ™ºèƒ½ç½‘ç»œçˆ¬è™«é¿é‡ç³»ç»Ÿ
print("\n=== å®æˆ˜åº”ç”¨ï¼šè¶…çº§ç½‘ç»œèœ˜è›› ===")
print("ä»»åŠ¡ï¼šçˆ¬å–ç½‘é¡µä½†ä¸è¦é‡å¤è®¿é—®ï¼ŒèŠ‚çœæ—¶é—´å’Œæµé‡ï¼")

# åˆ›å»ºä¸€ä¸ªèƒ½è®°ä½10000ä¸ªç½‘å€çš„ç³»ç»Ÿï¼Œè¯¯åˆ¤æ§åˆ¶åœ¨0.1%
url_filter = OptimizedBloomFilter(expected_elements=10000, false_positive_rate=0.001)

# è®°å½•å·²ç»è®¿é—®è¿‡çš„ç½‘ç«™
visited_urls = [
    "https://www.baidu.com",     # ç™¾åº¦é¦–é¡µ
    "https://www.google.com",    # è°·æ­Œé¦–é¡µ
    "https://github.com",        # ç¨‹åºå‘˜èšé›†åœ°
    "https://stackoverflow.com", # ç å†œæ•‘æ˜Ÿ
    "https://www.python.org"     # Pythonå®˜ç½‘
]

print("\nè®°å½•å·²è®¿é—®çš„ç½‘ç«™:")
for url in visited_urls:
    url_filter.add(url)

# æ£€æŸ¥æ–°å‘ç°çš„ç½‘å€
print("\næ£€æŸ¥å¾…çˆ¬å–ç½‘å€:")
new_urls = [
    "https://www.baidu.com",         # è€ç†Ÿäºº
    "https://www.newsite.com",       # æ–°å‘ç°
    "https://github.com",            # åˆæ˜¯è€ç†Ÿäºº
    "https://www.freshsite.com"      # åˆä¸€ä¸ªæ–°å‘ç°
]

for url in new_urls:
    if url_filter.contains(url):
        print(f"  '{url}' å¥½åƒçˆ¬è¿‡äº†ï¼Œè·³è¿‡èŠ‚çœæ—¶é—´ï¼")
    else:
        print(f"  '{url}' å…¨æ–°ç½‘ç«™ï¼Œå¼€å§‹çˆ¬å–å†…å®¹ï¼")

# ç”Ÿæˆèœ˜è››å·¥ä½œæŠ¥å‘Š
stats = url_filter.get_stats()
print(f"\nèœ˜è››å·¥ä½œæŠ¥å‘Š:")
print(f"   å·²è®°å½•ç½‘å€: {stats['elements_added']} ä¸ª")
print(f"   è®°å½•æœ¬ä½¿ç”¨ç‡: {stats['fill_rate']:.1%}")
print(f"   é¢„è®¡è¯¯åˆ¤ç‡: {stats['estimated_false_positive_rate']:.4%}")
print(f"   ç³»ç»Ÿè¯„ä»·: {'ä¼˜ç§€ï¼' if stats['estimated_false_positive_rate'] < 0.01 else 'è‰¯å¥½ï¼'}")
```

"å“‡å¡ï¼"å®‰å¦®çœ¼ç›äº®æ™¶æ™¶çš„ï¼Œ"åŸæ¥è¿˜èƒ½ç”¨æ•°å­¦å…¬å¼ç®—å‡ºæœ€å¥½çš„é…ç½®ï¼å°±åƒè°ƒé…é­”æ³•è¯æ°´çš„é…æ–¹ä¸€æ ·ï¼"

å¸Œå¨…æ¿€åŠ¨åœ°ç«™èµ·æ¥ï¼š"è¿™åœ¨å®é™…å·¥ä½œä¸­å¤ªæœ‰ç”¨äº†ï¼æˆ‘æƒ³åˆ°å¥½å¤šåº”ç”¨åœºæ™¯ï¼š

1. **åƒåœ¾é‚®ä»¶è¿‡æ»¤**ï¼šå¿«é€Ÿæ’é™¤è‚¯å®šä¸æ˜¯åƒåœ¾é‚®ä»¶çš„å†…å®¹ï¼Œå¯èƒ½æ˜¯åƒåœ¾é‚®ä»¶çš„å†è¿›ä¸€æ­¥æ£€æŸ¥
2. **å¯†ç å®‰å…¨æ£€æŸ¥**ï¼šå¿«é€Ÿæ’é™¤è‚¯å®šä¸åœ¨å¸¸ç”¨å¯†ç é»‘åå•ä¸­çš„å¯†ç ï¼Œå¯èƒ½åœ¨é»‘åå•ä¸­çš„å†è¯¦ç»†éªŒè¯  
3. **ç½‘ç»œå®‰å…¨é˜²æŠ¤**ï¼šå¿«é€Ÿæ’é™¤è‚¯å®šå®‰å…¨çš„IPåœ°å€ï¼Œå¯ç–‘IPå†æ·±åº¦åˆ†æ
4. **ç¼“å­˜ç³»ç»Ÿä¼˜åŒ–**ï¼šé¿å…æŸ¥è¯¢è‚¯å®šä¸åœ¨ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œå¯èƒ½åœ¨ç¼“å­˜ä¸­çš„å†å®é™…æŸ¥æ‰¾"


ä¼Šèè´å°”æ¸©æŸ”åœ°æ€»ç»“ï¼š"æ‰€ä»¥å¸ƒéš†è¿‡æ»¤å™¨çš„å“²å­¦æ˜¯'å®å¯å¤šç–‘ä¸€ç‚¹ï¼Œä¹Ÿä¸èƒ½æ”¾è¿‡ä»»ä½•å±é™©'ï¼Œè¿™åœ¨å¾ˆå¤šå®‰å…¨ç›¸å…³çš„åœºæ™¯ä¸­ç‰¹åˆ«æœ‰ä»·å€¼ã€‚"

è¿™æ—¶ï¼Œæ½¼æ½¼ä»é—¨å¤–æºœäº†è¿›æ¥ï¼Œçœ‹åˆ°å¤§å®¶å›´åœ¨ç™½æ¿å‰è®¨è®ºï¼Œå¥½å¥‡åœ°è·³åˆ°äº†æ¡Œå­ä¸Šï¼Œç”¨å°çˆªå­è½»æ‹é”®ç›˜ã€‚

"æ½¼æ½¼ä¹Ÿæƒ³å­¦ç½‘ç»œå®‰å…¨å‘¢ï¼"å®‰å¦®ç¬‘ç€è¯´ã€‚

é»›èŠ™è½»æŠšç€æ½¼æ½¼ï¼Œéš¾å¾—éœ²å‡ºæ¸©æŸ”çš„è¡¨æƒ…ï¼š"å¸ƒéš†è¿‡æ»¤å™¨æ•™ä¼šæˆ‘ä»¬ï¼Œåœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œæœ‰æ—¶å€™'è¿‘ä¼¼ä½†é«˜æ•ˆ'æ¯”'ç²¾ç¡®ä½†ç¼“æ…¢'æ›´æœ‰ä»·å€¼ã€‚å…³é”®æ˜¯è¦æ‰¾åˆ°å‡†ç¡®æ€§å’Œæ•ˆç‡ä¹‹é—´çš„æœ€ä½³å¹³è¡¡ç‚¹ã€‚"

å¤•é˜³é€è¿‡å®éªŒå®¤çš„è½åœ°çª—æ´’è¿›æ¥ï¼Œå¥¹ä»¬åœ¨ç™½æ¿ä¸Šè®°å½•ä¸‹ä»Šå¤©çš„æ”¶è·ï¼š

```
ğŸŒ¸ å¸ƒéš†è¿‡æ»¤å™¨çš„ç³–æœçŸ¥è¯† ğŸŒ¸
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”‘ æ ¸å¿ƒæ€æƒ³ï¼š
   åƒå¤šä¸ªé—¨å«åä½œçš„é­”æ³•ç³»ç»Ÿï¼Œç”¨å¾ˆå°çš„ç©ºé—´å¿«é€Ÿè¿‡æ»¤

ğŸ¯ å…³é”®ç‰¹æ€§ï¼š
    æ— å‡é˜´æ€§ï¼šç»ä¸ä¼šæ¼æ‰çœŸæ­£å­˜åœ¨çš„å…ƒç´ 
    æœ‰å‡é˜³æ€§ï¼šå¯èƒ½è¯¯åˆ¤ä¸å­˜åœ¨çš„å…ƒç´ ä¸ºå­˜åœ¨
    æŸ¥è¯¢è¶…å¿«ï¼šæ—¶é—´å¤æ‚åº¦ O(k)ï¼Œkæ˜¯å“ˆå¸Œå‡½æ•°æ•°é‡
    ç©ºé—´é«˜æ•ˆï¼šæ¯”ä¼ ç»Ÿå­˜å‚¨èŠ‚çœå¤§é‡ç©ºé—´

ğŸ§® é‡è¦å‚æ•°ï¼š
    ä½æ•°ç»„å¤§å° (m)ï¼šå½±å“å­˜å‚¨ç©ºé—´å’Œè¯¯åˆ¤ç‡
    å“ˆå¸Œå‡½æ•°æ•°é‡ (k)ï¼šå½±å“è®¡ç®—æ—¶é—´å’Œå‡†ç¡®æ€§
    å…ƒç´ æ•°é‡ (n)ï¼šå®é™…æ·»åŠ çš„å…ƒç´ ä¸ªæ•°
    è¯¯åˆ¤ç‡ (p)ï¼šå¯ä»¥é€šè¿‡æ•°å­¦å…¬å¼ä¼˜åŒ–åˆ°ç†æƒ³å€¼

ğŸŒŸ å®é™…åº”ç”¨ï¼š
   ğŸ•·ï¸ ç½‘ç»œçˆ¬è™«URLå»é‡    ğŸ“§ åƒåœ¾é‚®ä»¶å¿«é€Ÿè¿‡æ»¤
   ğŸ’¾ ç¼“å­˜ç³»ç»Ÿä¼˜åŒ–       ğŸ” æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
   ğŸ›¡ï¸ ç½‘ç»œå®‰å…¨é˜²æŠ¤       ğŸ”’ å¯†ç å®‰å…¨æ£€æŸ¥

ğŸ’­ è®¾è®¡å“²å­¦ï¼š
   "åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œå¿«é€Ÿæ’é™¤ä¸å¯èƒ½æ¯”æ…¢æ…¢ç¡®è®¤ä¸€åˆ‡æ›´æœ‰ä»·å€¼"
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

ä»Šå¤©å¥¹ä»¬ä¸ä»…å­¦ä¼šäº†å¸ƒéš†è¿‡æ»¤å™¨çš„æŠ€æœ¯åŸç†ï¼Œæ›´é‡è¦çš„æ˜¯ç†è§£äº†ä¸€ç§å…¨æ–°çš„è®¾è®¡æ€ç»´ï¼šæœ‰æ—¶å€™ï¼Œæ¥å—å°æ¦‚ç‡çš„è¯¯åˆ¤æ¥æ¢å–å¤§å¹…åº¦çš„æ•ˆç‡æå‡ï¼Œæ˜¯ä¸€ç§æ™ºæ…§çš„æƒè¡¡ã€‚

åœ¨è¿™ä¸ªå……æ»¡ä¸ç¡®å®šæ€§çš„æ•°å­—ä¸–ç•Œé‡Œï¼Œå¸ƒéš†è¿‡æ»¤å™¨æ•™ä¼šå¥¹ä»¬ï¼šå®Œç¾å¹¶éæ€»æ˜¯å¿…è¦çš„ï¼Œæœ‰æ—¶å€™"è¶³å¤Ÿå¥½ä¸”é«˜æ•ˆ"æ¯”"å®Œç¾ä½†ç¼“æ…¢"æ›´åŠ å®ç”¨ã€‚

---

> **å¸ƒéš†è¿‡æ»¤å™¨ (Bloom Filter)**ï¼šä¸€ç§ç©ºé—´é«˜æ•ˆçš„æ¦‚ç‡å‹æ•°æ®ç»“æ„ï¼Œç”¨äºå¿«é€Ÿåˆ¤æ–­å…ƒç´ æ˜¯å¦**å¯èƒ½å­˜åœ¨**äºé›†åˆä¸­ã€‚å®ƒé€šè¿‡å¤šä¸ªå“ˆå¸Œå‡½æ•°å°†å…ƒç´ æ˜ å°„åˆ°ä½æ•°ç»„çš„ä¸åŒä½ç½®ï¼Œå…·æœ‰**ç»å¯¹æ— å‡é˜´æ€§**ï¼ˆä¸ä¼šæ¼æ‰çœŸæ­£å­˜åœ¨çš„å…ƒç´ ï¼‰å’Œ**å¯èƒ½æœ‰å‡é˜³æ€§**ï¼ˆå¯èƒ½è¯¯åˆ¤ä¸å­˜åœ¨çš„å…ƒç´ ä¸ºå­˜åœ¨ï¼‰çš„ç‰¹æ€§ã€‚å¹¿æ³›åº”ç”¨äºç¼“å­˜ç³»ç»Ÿã€ç½‘ç»œçˆ¬è™«ã€åƒåœ¾é‚®ä»¶è¿‡æ»¤ç­‰éœ€è¦å¿«é€Ÿè¿‡æ»¤çš„åœºæ™¯ã€‚

> **ä»Šæ—¥å…³é”®è¯ ğŸ­**ï¼š
> - **ä½æ•°ç»„ (Bit Array)**ï¼šç”¨0å’Œ1å­˜å‚¨ä¿¡æ¯çš„é«˜æ•ˆæ•°ç»„ç»“æ„ï¼Œæ¯ä¸ªä½ç½®åªå 1ä½ç©ºé—´
> - **å“ˆå¸Œå‡½æ•°æ•°é‡ (k)**ï¼šå½±å“è¯¯åˆ¤ç‡å’ŒæŸ¥è¯¢æ—¶é—´çš„å…³é”®å‚æ•°ï¼Œéœ€è¦ç²¾å¿ƒå¹³è¡¡
> - **å‡é˜³æ€§ (False Positive)**ï¼šè¯¯åˆ¤ä¸å­˜åœ¨çš„å…ƒç´ ä¸ºå­˜åœ¨ï¼Œå¯ä»¥é€šè¿‡è°ƒæ•´å‚æ•°æ§åˆ¶æ¦‚ç‡
> - **å‡é˜´æ€§ (False Negative)**ï¼šè¯¯åˆ¤å­˜åœ¨çš„å…ƒç´ ä¸ºä¸å­˜åœ¨ï¼Œåœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­æ°¸è¿œä¸ä¼šå‘ç”Ÿ
> - **åŒé‡å“ˆå¸Œ (Double Hashing)**ï¼šç”¨ä¸¤ä¸ªåŸºç¡€å“ˆå¸Œå‡½æ•°ç”Ÿæˆå¤šä¸ªç‹¬ç«‹å“ˆå¸Œå€¼çš„å·§å¦™æŠ€æœ¯
> - **æœ€ä¼˜å‚æ•°è®¡ç®—**ï¼šé€šè¿‡æ•°å­¦å…¬å¼è®¡ç®—ä½æ•°ç»„å¤§å°å’Œå“ˆå¸Œå‡½æ•°æ•°é‡çš„æœ€ä½³é…ç½®

> **å®è·µç»ƒä¹ é¢˜**ï¼š
> 1. **åŸºç¡€å¸ƒéš†è¿‡æ»¤å™¨å®ç°**ï¼šæ‰‹åŠ¨å®ç°ä¸€ä¸ªåŒ…å«addå’Œcontainsæ–¹æ³•çš„ç®€å•å¸ƒéš†è¿‡æ»¤å™¨ â­â­
> 2. **æ™ºèƒ½å‚æ•°è®¡ç®—å™¨**ï¼šæ ¹æ®é¢„æœŸå…ƒç´ æ•°é‡å’Œè¯¯åˆ¤ç‡è‡ªåŠ¨è®¡ç®—æœ€ä¼˜é…ç½® â­â­â­
> 3. **ç½‘ç»œçˆ¬è™«URLå»é‡**ï¼šç”¨å¸ƒéš†è¿‡æ»¤å™¨ä¸ºç½‘ç»œçˆ¬è™«å®ç°é«˜æ•ˆçš„URLå»é‡åŠŸèƒ½ â­â­â­
> 4. **è¯¯åˆ¤ç‡å®éªŒéªŒè¯**ï¼šé€šè¿‡å¤§é‡æµ‹è¯•éªŒè¯ç†è®ºè¯¯åˆ¤ç‡å…¬å¼çš„å‡†ç¡®æ€§ â­â­â­â­
> 5. **å“ˆå¸Œå‡½æ•°ä¼˜åŒ–**ï¼šå®éªŒä¸åŒå“ˆå¸Œå‡½æ•°ç»„åˆå¯¹è¯¯åˆ¤ç‡çš„å½±å“ â­â­â­â­