### **12.6 石碑铭刻的刷题邀约【查找·LeetCode】**

*"古老的谜题，镌刻于石碑之上，等待着掌握了‘秩序’与‘半折’秘法之人前来解读。"*

结束了对查找算法的全面回顾，夜色已深。但女孩们学习的热情，却像山顶的星辰一样，愈发璀璨。她们回到了温暖的社团活动室，准备迎接本章的最后试炼。

“理论的地图已经绘制完成，现在，是时候去真正的‘藏宝地’一探究竟了。”希娅打开了LeetCode，界面上显示着她挑选的题目，她将这次练习称之为“石碑铭刻的刷题邀约”。

“这些题目，就像是古代文明留下的石碑谜题，”她解释道，“有些需要我们用最质朴的工具（顺序查找）去解读，而另一些，则需要我们念出‘二分’的咒语，才能解开封印。”

#### **第一块石碑：最纯粹的咒语 (Binary Search)**

希娅点开第一题：**LC 704. 二分查找**。

“这是第一块，也是最重要的一块石碑。它不要求别的，只要求我们能准确、无误地念出‘二分查找’这道最核心的咒语。”

安妮看着题目，自信地点了点头：“这道题是基础，考验的就是我们对`left`, `right`, `mid`三个指针和边界条件的理解！”

她很快就在纸上写下了核心代码，并特别注意了`left <= right`和`mid = left + (right - left) // 2`这两个关键细节。

“非常好，”黛芙评价道，“能写对基础的二分查找，是掌握后续所有变体的基础。这块石碑，我们就算是通过了。”

#### **第二块石碑：寻找消失的边界 (Search Insert Position)**

接下来是第二题：**LC 35. 搜索插入位置**。

“这块石碑的谜题是：在一个有序数组中，找到目标值。如果找不到，就返回它应该被插入的位置。”

“这……”安妮思索起来，“如果找到了，那就和标准二分一样。如果找不到，循环结束时，`left`和`right`指针会是什么状态呢？”

她模拟了一下查找`6`的过程，在数组`[1, 3, 5, 7]`中：
- `mid=3`, `5 < 6`, `left`变成`3`。
- `mid=5`, `7 > 6`, `right`变成`2`。
- 此时 `left(3) > right(2)`，循环结束。

“我发现了！”安妮激动地说，“循环结束时，`left`指针指向的位置，恰好就是第一个大于等于目标值的位置，也就是它应该插入的地方！”

```python
def search_insert(arr: list, target: int) -> int:
    left, right = 0, len(arr) - 1
    while left <= right:
        mid = left + (right - left) // 2
        if arr[mid] == target:
            return mid
        elif arr[mid] < target:
            left = mid + 1
        else:
            right = mid - 1
    # 循环结束，left指针就是插入位置
    return left
```

“精彩的推理！”伊莎贝尔赞道，“你通过分析循环终止时的状态，解读出了指针的额外含义。这块石碑，你也解开了。”

#### **第三块石碑：旋转的星图 (Search in Rotated Sorted Array)**

“准备好迎接挑战了吗？”希娅的表情变得兴奋起来，“第三块石碑，是最著名、也是最常出现的谜题之一：**LC 33. 搜索旋转排序数组**。”

题目描述是：一个原本升序的数组，在某个未知的点上进行了旋转（例如 `[0,1,2,4,5,6,7]` 可能变成 `[4,5,6,7,0,1,2]`），要求在这个旋转后的数组中查找一个目标值，时间复杂度必须为O(logN)。

“O(logN)的查找，那必定是二分查找！”安妮立刻确定了方向，“但是数组不再是完全有序的了，我们怎么判断该去左边还是右边呢？”

“这正是谜题的关键，”黛芙提示道，“虽然整个数组不再有序，但当我们把它从`mid`位置一分为二时，其中‘必定有一半’是保持着原始的有序状态的！”

她在白板上画图分析：

```ascii
旋转数组: [ 4, 5, 6, 7, 0, 1, 2 ]
             L↑         M↑       R↑

1. mid 在 7。比较 arr[L](4) 和 arr[M](7)。
   - 因为 4 < 7, 所以 [L, M] 这一段，即 [4, 5, 6, 7]，是完全有序的。
   - 另一半 [0, 1, 2] 则是旋转过的。

2. 既然左半边有序，我们就可以判断 target 是否在 [4, 7] 这个区间内。
   - 如果在，我们就在左半边进行二分查找。
   - 如果不在，我们就去右半边那段“旋转过”的数组里继续寻找。

旋转数组: [ 7, 0, 1, 2, 4, 5, 6 ]
             L↑         M↑       R↑

1. mid 在 2。比较 arr[L](7) 和 arr[M](2)。
   - 因为 7 > 2, 所以 [L, M] 这一段是旋转过的。
   - 那么，另一半 [M, R]，即 [2, 4, 5, 6]，必定是完全有序的。

2. 既然右半边有序，我们就可以判断 target 是否在 [4, 6] 这个区间内。
   - ...
```

“我明白了！”安妮豁然开朗，“关键就在于，每次都先通过`arr[left]`和`arr[mid]`的比较，判断出哪一半是‘好’的（有序的），然后就可以在‘好’的那一半里为所欲为，或者排除掉它，去另一半‘坏’的里面继续重复这个过程！”

这个夜晚，在对一块块“石碑谜题”的解读中，安妮对二分查找的理解，从一个僵硬的模板，变成了一把可以灵活变形、应对各种复杂地形的瑞士军刀。她真正领会到，算法的精髓，不在于背诵代码，而在于理解其核心思想，并将其创造性地应用于千变万化的谜题之中。

---

🌸 **查找应用核心要点** 🌸

**1. 算法设计的根本思想**
- **识别“单调性”：** 二分查找的适用范围，远不止“有序数组”。任何一个问题，只要其解空间是连续的，并且我们可以定义一种“单调”的评价函数（即随着解的增大，评价结果持续增大或减小），就可以考虑使用二分查找的思想，对“解”本身进行二分。
- **边界条件的精确定义：** 查找左右边界、寻找第一个/最后一个满足条件的元素等问题，都要求对二分查找的循环条件（`<=`还是`<`）、区间更新（`mid`还是`mid-1`/`mid+1`）有极其精确的理解和定义。
- **问题分解与转化：** 旋转数组查找问题，通过“判断哪一半有序”，成功地将一个复杂问题，在O(logN)的每一步中，都转化为了一个“在有序子数组中查找”的简单问题。

**2. 核心设计哲学**
- **从“查找值”到“查找边界”：** 很多二分查找的变体，其目标不再是简单地找到一个值，而是找到满足某个条件的“边界”，如“第一个大于X的数”或“最后一个小于X的数”。这要求我们将思维从“等于”判断，扩展到对“大于/小于”区间的划分。
- **二分答案（Binary Search on Answer）：** 对于一些求解“最小值最大化”或“最大值最小化”的复杂问题（如LC.410, LC.875），我们可以不直接求解，而是对“答案”本身进行二分。通过一个`check`函数来判断当前的“猜测答案”是否可行，从而不断逼近最优解。这是一种更高维度的二分思想。
- **不变性与循环：** 任何正确的二分查找实现，都隐含着一个循环不变量（Loop Invariant），例如“目标一定在闭区间`[left, right]`内”。理解并维护这个不变量，是写出正确代码的关键。

**3. 算法思维的启发**
- **模板化与定制化：** 掌握一个或两个健壮的二分查找模板是基础。但更重要的是，要能根据具体问题的不同（如查找边界、旋转数组），对模板进行微调和定制。
- **对数思维：** 习惯于用“对半”的方式来思考问题。当遇到一个看似需要遍历才能解决的问题时，多问一句：“这个问题是否具有某种单调性，能否通过排除一半的解来加速？”
- **代码的简洁与鲁棒：** 二分查找是体现代码功力的一个绝佳舞台。用最简洁、最清晰、最不易出错的方式实现它，是每个程序员的必修课。

---

🎀 **安妮的小小日记本**

今晚的刷题会，简直像一场解谜大会！

我以前以为，二分查找就是在一个排好序的队伍里找人。但今天我才发现，它还能在“断裂”的队伍（旋转数组）里找人，还能帮我找到队伍里第一个迟到的人（第一个坏版本），甚至还能帮我决定一个“最优方案”（二分答案）！

它就像一把魔法钥匙，能打开的锁，远比我想象的要多得多。关键在于，我得学会识别那些“长得像锁”的“问题”。黛芙学姐说的“单调性”，就是识别这些锁的秘诀。

写对一个基础的二分查找，可能只是掌握了咒语的发音。而今天，我感觉自己开始理解这个咒语背后的魔力来源了。下一次，面对一个新谜题时，我一定会多长一个心眼，问问自己：“这里……能用二分吗？”

---

### 今日关键词

- **二分查找变体 (Binary Search Variants):** 指在标准二分查找基础上，为解决特定问题（如查找边界、旋转数组）而做的修改和调整。
- **查找边界 (Searching for Boundaries):** 一类二分查找问题，其目标是寻找满足某个条件的第一个或最后一个元素。
- **旋转排序数组 (Rotated Sorted Array):** 一个有序数组经过旋转后得到的数组。它在局部上保持了有序性。
- **二分答案 (Binary Search on Answer):** 一种算法思想，适用于求解满足某些约束条件下的最大值最小化或最小值最大化问题。通过对“答案”的可能范围进行二分查找来求解。
- **循环不变量 (Loop Invariant):** 在循环的每次迭代之前和之后都保持成立的一种性质。它是证明循环算法正确性的重要工具。

### 推荐练习题目 🧲  
> 难度标注：⭐ = Easy ⭐⭐ = Medium ⭐⭐⭐ = Hard
> 建议顺序：基础 ➜ 进阶 ➜ 面试
> （本章的练习题已在12.2节中详细列出，此处不再重复。请参考12.2节的推荐列表，深入练习各种二分查找的变体和应用。）
