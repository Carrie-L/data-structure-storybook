### **14.6 围炉夜话的刷题思辨【DP·LeetCode】**

*"当篝火燃尽，余温仍在，每一次的思辨，都将智慧的灰烬，沉淀为明日远行的坚实土地。"*

露营的最后一晚，篝火静静地燃烧，发出温暖的余光。在系统地学习了动态规划的核心思想、两种实现范式以及背包和序列两大经典模型后，女孩们迎来了一场特别的“围炉夜话”。

“今晚，我们不学新东西。”黛芙微笑着说，“我们来‘品味’DP。动态规划的题目，千变万化，但万变不离其宗。关键在于，我们能否剥开问题的外壳，识别出其DP的内核，并正确地定义出‘状态’和‘转移’。”

希娅已经准备好了题目，她称之为“DP的终极思辨”。

#### **第一道茶：打家劫舍的智慧 (House Robber)**

希娅展示了第一题：**LC 198. 打家劫舍**。

“这个问题我们之前在介绍DP思想时提到过。一个小偷要去一条街上偷东西，每间房里都有一定金额的钱。但有一个限制：如果偷了某一间，就不能偷相邻的下一间。求能偷到的最高总金额。”

“这个问题，我来试试！”安妮自告奋勇。她已经对这个问题有了初步的思考。

1.  **状态定义:** “`dp[i]` 应该定义为‘在前 `i` 间房子里，能偷到的最高金额’。”
2.  **状态转移:** “对于第 `i` 间房子，我有两种选择：”
    -   “**不偷**第 `i` 间：那么我能获得的最大金额，就等于在前 `i-1` 间房子里偷到的最大金额，即 `dp[i-1]`。”
    -   “**偷**第 `i` 间：那我就不能偷第 `i-1` 间。所以，我能获得的最大金额，等于第 `i` 间房子的钱 `nums[i]`，加上‘在前 `i-2` 间房子里偷到的最大金额’，即 `nums[i] + dp[i-2]`。”
    -   “所以，状态转移方程是：`dp[i] = max(dp[i-1], nums[i] + dp[i-2])`！”
3.  **基例:** “`dp[0]` 是偷第一间房的钱，`dp[1]`是前两间房里偷钱的最大值。”

“完全正确！”黛芙和伊莎贝尔都露出了赞许的笑容。安妮不仅准确地说出了DP的解法，更重要的是，她清晰地阐述了每一个决策背后的逻辑。这标志着她已经真正开始用DP的思维模式来思考问题。

#### **第二道茶：买卖股票的最佳时机 (Best Time to Buy and Sell Stock)**

“下一题，我们来当一回股神。”希娅点开 **LC 121. 买卖股票的最佳时机**。

“题目给了一个数组，`prices[i]`是第`i`天股票的价格。你只能进行一次‘买入’和一次‘卖出’，求能获得的最大利润。”

“这个问题……”安妮思索着，“我可以在第`i`天卖出，那么为了利润最大，我就必须在第`i`天之前的、价格最低的那一天买入。”

“很好的思路！”黛芙说，“这是一种O(N)的解法，通过一次遍历，同时记录‘历史最低价格’和‘当前最大利润’。但我们今天，能不能也用DP的语言来描述它呢？”

“DP的语言……”安妮尝试着套用DP的框架。

1.  **状态定义:** “`dp[i]` 代表什么呢？‘前`i`天的最大利润’？”
2.  **状态转移:** “`dp[i]` 和 `dp[i-1]` 有什么关系？第`i`天的最大利润，要么是前`i-1`天的最大利润，要么是今天卖出能获得的最大利润。今天卖出的利润是 `prices[i] - (前i-1天的最低价格)`。”

“顺着这个思路，我们发现，DP的状态需要包含两个维度，”黛芙接道，“一个维度是天数`i`，另一个维度是‘我当前是否持有股票’。”

**状态定义 (二维):**
-   `dp[i][0]`: 第`i`天，**不持有**股票的情况下，拥有的最大现金。
-   `dp[i][1]`: 第`i`天，**持有**股票的情况下，拥有的最大现金。

**状态转移:**
-   `dp[i][0] = max(dp[i-1][0], dp[i-1][1] + prices[i])`
    -   (昨天就不持有 vs. 昨天持有，今天卖了)
-   `dp[i][1] = max(dp[i-1][1], -prices[i])`
    -   (昨天就持有 vs. 昨天不持有，今天买了。因为只买一次，所以是`-prices[i]`) 

“虽然这个问题用简单的贪心思路更容易理解，但用DP的状态机模型来分析，为我们解决后续更复杂的股票问题（如可以多次买卖、有冷冻期等）提供了一个统一的、可扩展的框架。”黛芙总结道。

#### **第三道茶：不同路径的想象 (Unique Paths)**

最后，希娅调出了 **LC 62. 不同路径**。

“一个机器人在一个`m x n`的网格左上角，每次只能向右或向下移动，要想到达右下角，总共有多少条不同的路径？”

“这道题我好像有印象！”安妮立刻说，“我们在学表格法的时候提到过！”

1.  **状态定义:** `dp[i][j]` 代表从左上角 `(0,0)` 到达格子 `(i,j)` 的总路径数。
2.  **状态转移:** “要想到达格子`(i,j)`，只能从它的上方`(i-1,j)`或者左方`(i,j-1)`过来。所以，到达`(i,j)`的总路径数，就是到达它上方和左方路径数的总和！”
    -   **`dp[i][j] = dp[i-1][j] + dp[i][j-1]`**
3.  **基例:** “第一行和第一列的所有格子，都只有1条路径可以到达（一直向右或一直向下）。”

“完美！”黛芙笑道，“你已经能举一反三，将之前学过的模型，应用到新的问题中了。”

围炉夜话，茶香袅袅。这一晚，没有复杂的推导，没有全新的概念，只有对已有知识的反刍、思辨与升华。安妮感觉，动态规划不再是一座座孤立的山峰（背包、LCS、LIS），而是一整片连绵不绝、彼此关联的山脉。而她，已经学会了如何在这片山脉中，辨认方向，寻找路径。

---

🌸 **DP应用核心要点** 🌸

**1. 算法设计的根本思想**
- **识别DP模式：** 解决DP问题的首要任务，是识别出问题的内在模式。它是线性模型（爬楼梯、打家劫舍），还是二维模型（路径问题），是背包模型，还是序列模型？识别出正确的模型，是套用相应DP思路的前提。
- **定义状态是艺术：** 状态的定义直接决定了状态转移方程的难易。一个好的状态定义，应该具备“无后效性”，并且能清晰地描述一个子问题。有时，为了更好地转移，需要为状态增加维度（如股票问题中的“是否持有”）。
- **从暴力递归出发：** 当对一个问题毫无头绪时，尝试写出它的暴力递归解法，是一个非常好的出发点。然后，分析这个递归解法中是否存在“重叠子问题”，并尝试对其进行“记忆化”改造，就能自然地过渡到DP的解法。

**2. 核心设计哲学**
- **DP是一种“填表”思想：** 无论是自顶向下还是自底向上，DP的本质都是在“填充”一张关于所有子问题解的表格。理解这一点，有助于我们将各种DP问题都统一到“如何填表”这个核心思路上来。
- **空间与时间的永恒权衡：** 很多DP问题，都可以通过“滚动数组”等技巧进行空间优化。在面试中，给出O(N)空间的解法后，能进一步想到O(1)空间的优化，是重要的加分项。
- **统一的框架：** 股票系列问题展示了DP作为一种“建模框架”的威力。通过定义`dp[i][k][持有/未持有]`（第i天，最多交易k次，当前持股状态），几乎可以统一解决所有股票买卖问题，体现了DP框架的扩展性。

**3. 算法思维的启发**
- **“换个角度看问题”：** 很多问题，直接求解很困难，但其“反面”或“子问题”可能具有清晰的DP结构。例如，“分割等和子集”问题，就巧妙地转化为了一个0-1背包问题。
- **培养“DP感”：** 大量地练习不同类型的DP题目，是培养对DP问题“嗅觉”的唯一途径。做得多了，看到“最大/最小”、“总共有多少种方法”、“是否可行”这类字眼，就能本能地联想到DP。
- **从一维到多维：** 熟练掌握一维线性DP（如爬楼梯）是基础。在此之上，逐步挑战二维DP（如路径、背包、LCS），再到更复杂的状态压缩DP、树形DP等，是DP能力的进阶之路。

---

🎀 **安妮的小小日记本**

今晚的“围炉夜话”，更像是一场“武林大会”的复盘。我们把之前学过的各种DP招式，都在实际的“比武”（题目）中演练了一遍。

我发现，我现在看到一个问题，不再是满脑子浆糊了。我会先尝试去给它“分类”：它像“爬楼梯”吗？还是像“打家劫舍”？或者，它是不是一个“背包”？一旦找到了它所属的“门派”，解决起来就有了清晰的方向。

这个过程，就像侦探破案。定义`dp`数组，就像确定嫌疑人的范围；寻找状态转移方程，就像梳理线索之间的逻辑链；确定基例，就像找到案件的第一个突破口。当所有线索都串联起来，答案就水落石出了。

虽然我知道，DP的世界还有更广阔的星辰大海在等着我，但今晚，我感觉自己已经拿到了那张宝贵的船票。前路漫漫，亦灿灿！

---

### 今日关键词

- **DP解题五步曲:** 一种解决DP问题的通用思路框架，通常包括：1. 定义dp数组的含义；2. 确定状态转移方程；3. 初始化dp数组（包括基例）；4. 确定遍历顺序；5. 返回最终答案。
- **状态机模型 (State Machine Model):** 一种用DP解决问题的视角，将问题看作一个状态机，每个状态包含若干信息，决策导致状态之间的转移。股票问题是其经典应用。
- **滚动数组优化 (Rolling Array Optimization):** （回顾）DP空间优化的重要技巧，当`dp[i]`只依赖于`dp[i-1]`或`dp[i-2]`等少量历史状态时，可以用有限变量代替DP数组。

### 推荐练习题目 🧲  
> 难度标注：⭐ = Easy ⭐⭐ = Medium ⭐⭐⭐ = Hard
> 建议顺序：基础 ➜ 进阶 ➜ 面试
> （本章的练习题已在14.1至14.5节中详细列出，此处不再重复。请参考之前的推荐列表，深入练习不同模型的DP问题。）
